name: Auto Format Code

on:
  workflow_dispatch:
  
jobs:
  format:
    name: Format Code
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        ref: ci-workflow-v2
        
    - name: Setup Flutter
      uses: subosito/flutter-action@v2
      with:
        channel: stable
        cache: true
        
    - name: Format code
      run: |
        echo "Formatting code..."
        dart format .
        
    - name: Commit changes
      run: |
        git config --local user.email "action@github.com"
        git config --local user.name "GitHub Action"
        
        if ! git diff --quiet; then
          echo "Code formatting changes detected"
          git add .
          git commit -m "style: auto-format code with dart format

[skip ci]"
          git push
          echo "✅ Formatting changes committed and pushed"
        else
          echo "✅ No formatting changes needed"
        fi