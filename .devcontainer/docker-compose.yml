# Set project name
name: dartwingers

version: '3.8'

services:
  app:
    container_name: dartwing_app
    build:
      context: .
      dockerfile: Dockerfile
      args:
        USER_UID: "1000"
        USER_GID: "1000"
        USERNAME: "brett"
    
    volumes:
      - ../..:/workspaces:cached
    
    environment:
      FLUTTER_ROOT: /opt/flutter
      ANDROID_SDK_ROOT: /opt/android-sdk
      ANDROID_HOME: /opt/android-sdk
      # Note: Using local ADB server instead of host ADB server
    
    ports:
      - "3000:3000"
      - "8180:8080"
      - "8000:8000"
      # Note: No port 5037 binding - container acts as ADB client to host server
      - "5554:5554"  # Emulator console port
      - "5555:5555"  # Emulator ADB port
      - "42000:42000"
      - "42001:42001"
      - "42002:42002"
      - "42003:42003"
      - "42004:42004"
    
    networks:
      - dartnet
    
    # Keep container running
    command: sleep infinity
    
    # Use host networking for better Android emulator connectivity (optional)
    # Uncomment the line below and comment out the ports section if needed
    # network_mode: host

networks:
  dartnet:
    name: dartnet
    driver: bridge
