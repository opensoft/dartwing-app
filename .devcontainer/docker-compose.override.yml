# Docker Compose Override for Dartwingers Projects
# This file adds .NET service container to the base Flutter setup
# 
# Usage: Docker Compose automatically merges this with docker-compose.yml
# Result: Flutter app container + .NET service container

services:
  app:
    # Add .NET service connection to Flutter container
    environment:
      - SERVICE_API_URL=http://service:5000  # Connect to .NET service
    
    # Service dependencies
    depends_on:
      - service

  # .NET Web API Service Container
  service:
    image: mcr.microsoft.com/dotnet/sdk:8.0
    container_name: ${PROJECT_NAME:-myproject}_service
    
    # Runtime environment variables
    environment:
      - ASPNETCORE_ENVIRONMENT=Development
      - ASPNETCORE_URLS=http://+:5000
      - ASPNETCORE_HTTP_PORTS=5000
    
    # Network configuration
    networks:
      - dartnet
    
    # Volume mounts for .NET service code
    volumes:
      # Mount a service directory if it exists, otherwise create empty volume
      - service-code:/app
      # Persist .NET packages cache
      - dotnet-nuget-cache:/root/.nuget/packages
    
    # Port mappings for .NET service
    ports:
      - "${SERVICE_PORT:-5000}:5000"       # .NET Web API
      - "${SERVICE_DEBUG_PORT:-5001}:5001" # HTTPS (optional)
    
    # Resource limits (optional)
    deploy:
      resources:
        limits:
          memory: ${SERVICE_MEMORY:-2g}
          cpus: '${SERVICE_CPUS:-1}'
    
    # Working directory
    working_dir: /app
    
    # Keep container running for development
    command: tail -f /dev/null
    
    # Restart policy
    restart: unless-stopped

# Additional volumes for .NET service
volumes:
  service-code:
    name: service-code-${PROJECT_NAME:-myproject}
  dotnet-nuget-cache:
    name: dotnet-nuget-cache-${PROJECT_NAME:-myproject}